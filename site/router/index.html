<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Guides, references, and roadmaps for the Bamboo microframework"><link href=https://greenarmor.github.io/bamboo/router/ rel=canonical><link href=../modules/ rel=prev><link href=../configuration/overview/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.20"><title>Router - Bamboo Documentation</title><link rel=stylesheet href=../assets/stylesheets/main.e53b48f4.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#http-router-contract-v10-freeze class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Bamboo Documentation" class="md-header__button md-logo" aria-label="Bamboo Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Bamboo Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Router </span> </div> </div> </div> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/greenarmor/bamboo title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> greenarmor/bamboo </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Bamboo Documentation" class="md-nav__button md-logo" aria-label="Bamboo Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Bamboo Documentation </label> <div class=md-nav__source> <a href=https://github.com/greenarmor/bamboo title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> greenarmor/bamboo </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Installation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Installation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Install-Bamboo-PHP82/ class=md-nav__link> <span class=md-ellipsis> PHP 8.2 </span> </a> </li> <li class=md-nav__item> <a href=../Install-Bamboo-PHP83/ class=md-nav__link> <span class=md-ellipsis> PHP 8.3 </span> </a> </li> <li class=md-nav__item> <a href=../Install-Bamboo-PHP84/ class=md-nav__link> <span class=md-ellipsis> PHP 8.4 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Framework Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Framework Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../modules/ class=md-nav__link> <span class=md-ellipsis> Modules </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Router </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Router </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#route-registration-and-helpers class=md-nav__link> <span class=md-ellipsis> Route registration and helpers </span> </a> <nav class=md-nav aria-label="Route registration and helpers"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#supported-methods class=md-nav__link> <span class=md-ellipsis> Supported methods </span> </a> </li> <li class=md-nav__item> <a href=#route-definitions class=md-nav__link> <span class=md-ellipsis> Route definitions </span> </a> </li> <li class=md-nav__item> <a href=#parameter-tokens class=md-nav__link> <span class=md-ellipsis> Parameter tokens </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#middleware-composition class=md-nav__link> <span class=md-ellipsis> Middleware composition </span> </a> </li> <li class=md-nav__item> <a href=#error-handling class=md-nav__link> <span class=md-ellipsis> Error handling </span> </a> </li> <li class=md-nav__item> <a href=#route-caching-contract class=md-nav__link> <span class=md-ellipsis> Route caching contract </span> </a> </li> <li class=md-nav__item> <a href=#deprecation-policy class=md-nav__link> <span class=md-ellipsis> Deprecation policy </span> </a> </li> <li class=md-nav__item> <a href=#contract-validation class=md-nav__link> <span class=md-ellipsis> Contract validation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class=md-ellipsis> Configuration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Configuration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../configuration/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <div class="md-nav__link md-nav__container"> <a href=../cli/ class="md-nav__link "> <span class=md-ellipsis> CLI </span> </a> <label class="md-nav__link " for=__nav_4 id=__nav_4_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> CLI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../cli/jwt-auth-toolkit/ class=md-nav__link> <span class=md-ellipsis> JWT Auth Toolkit </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <div class="md-nav__link md-nav__container"> <a href=../tasks/ class="md-nav__link "> <span class=md-ellipsis> Tasks </span> </a> <label class="md-nav__link " for=__nav_5 id=__nav_5_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Tasks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../tasks/config-validation-ci/ class=md-nav__link> <span class=md-ellipsis> Config Validation in CI </span> </a> </li> <li class=md-nav__item> <a href=../tasks/benchmarks-baseline-dataset/ class=md-nav__link> <span class=md-ellipsis> Benchmarks Baseline Dataset </span> </a> </li> <li class=md-nav__item> <a href=../tasks/upgrade-guide-config-deprecations/ class=md-nav__link> <span class=md-ellipsis> Upgrade Guide Config Deprecations </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <div class="md-nav__link md-nav__container"> <a href=../benchmarks/ class="md-nav__link "> <span class=md-ellipsis> Benchmarks </span> </a> <label class="md-nav__link " for=__nav_6 id=__nav_6_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Benchmarks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../benchmarks/data/20240528-baseline/ class=md-nav__link> <span class=md-ellipsis> Baseline Dataset (2024-05-28) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../starters/ class=md-nav__link> <span class=md-ellipsis> Starters </span> </a> </li> <li class=md-nav__item> <a href=../OpenSwoole-Compat-and-Fixes/ class=md-nav__link> <span class=md-ellipsis> Compatibility </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex> <span class=md-ellipsis> Upgrade </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Upgrade </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../upgrade/v1.0/ class=md-nav__link> <span class=md-ellipsis> Bamboo v1.0 Upgrade Guide </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_10> <label class=md-nav__link for=__nav_10 id=__nav_10_label tabindex> <span class=md-ellipsis> Roadmap </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_10_label aria-expanded=false> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Roadmap </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../roadmap/v0.3-prep/ class=md-nav__link> <span class=md-ellipsis> v0.3 Prep </span> </a> </li> <li class=md-nav__item> <a href=../roadmap/v0.4-prep/ class=md-nav__link> <span class=md-ellipsis> v0.4 Prep </span> </a> </li> <li class=md-nav__item> <a href=../roadmap/v1.0-prep/ class=md-nav__link> <span class=md-ellipsis> v1.0 Prep </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#route-registration-and-helpers class=md-nav__link> <span class=md-ellipsis> Route registration and helpers </span> </a> <nav class=md-nav aria-label="Route registration and helpers"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#supported-methods class=md-nav__link> <span class=md-ellipsis> Supported methods </span> </a> </li> <li class=md-nav__item> <a href=#route-definitions class=md-nav__link> <span class=md-ellipsis> Route definitions </span> </a> </li> <li class=md-nav__item> <a href=#parameter-tokens class=md-nav__link> <span class=md-ellipsis> Parameter tokens </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#middleware-composition class=md-nav__link> <span class=md-ellipsis> Middleware composition </span> </a> </li> <li class=md-nav__item> <a href=#error-handling class=md-nav__link> <span class=md-ellipsis> Error handling </span> </a> </li> <li class=md-nav__item> <a href=#route-caching-contract class=md-nav__link> <span class=md-ellipsis> Route caching contract </span> </a> </li> <li class=md-nav__item> <a href=#deprecation-policy class=md-nav__link> <span class=md-ellipsis> Deprecation policy </span> </a> </li> <li class=md-nav__item> <a href=#contract-validation class=md-nav__link> <span class=md-ellipsis> Contract validation </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=http-router-contract-v10-freeze>HTTP Router Contract (v1.0 Freeze)<a class=headerlink href=#http-router-contract-v10-freeze title="Permanent link">&para;</a></h1> <p>Bamboo routes requests through <code>Bamboo\Core\Router</code>, a thin wrapper around FastRoute tuned for long-lived OpenSwoole workers. The router API is part of the v1.0 public contract; helpers, middleware semantics, and error payloads will remain stable across the 1.x series.</p> <h2 id=route-registration-and-helpers>Route registration and helpers<a class=headerlink href=#route-registration-and-helpers title="Permanent link">&para;</a></h2> <p>Applications and modules obtain the router from the container (<code>$app-&gt;get('router')</code>) or inject it into service providers. Routes can be registered at bootstrap time or cached to disk.</p> <div class=highlight><pre><span></span><code><span class=x>$router-&gt;get(&#39;/hello/{name}&#39;, [GreetingController::class, &#39;show&#39;]);</span>
<span class=x>$router-&gt;post(&#39;/jobs&#39;, RouteDefinition::forHandler([</span>
<span class=x>    JobController::class, &#39;enqueue&#39;],</span>
<span class=x>    middlewareGroups: [&#39;queue&#39;],</span>
<span class=x>));</span>
<span class=x>$router-&gt;addRoute(&#39;DELETE&#39;, &#39;/cache/{key}&#39;, function (ServerRequestInterface $request, array $vars) {</span>
<span class=x>    return new JsonResponse([&#39;deleted&#39; =&gt; $vars[&#39;key&#39;]]);</span>
<span class=x>});</span>
</code></pre></div> <h3 id=supported-methods>Supported methods<a class=headerlink href=#supported-methods title="Permanent link">&para;</a></h3> <ul> <li><code>Router::get(string $path, callable|array|RouteDefinition $handler, array $middleware = [], array $groups = [])</code></li> <li><code>Router::post(...)</code></li> <li><code>Router::addRoute(string $method, string $path, ...)</code></li> </ul> <p><code>addRoute</code> accepts any valid HTTP verb and stores the definition internally with a normalised signature. Custom helpers can wrap <code>addRoute</code> when additional verbs (such as PUT, PATCH, DELETE) are required.</p> <h3 id=route-definitions>Route definitions<a class=headerlink href=#route-definitions title="Permanent link">&para;</a></h3> <p>Handlers can be expressed as:</p> <ul> <li>A PHP callable (<code>function (...) { ... }</code>).</li> <li>A controller tuple <code>[ClassName::class, 'method']</code>.</li> <li>An associative array with <code>handler</code>, <code>middleware</code>, <code>middleware_groups</code>, or legacy keys (<code>uses</code>, <code>action</code>).</li> <li>A <code>Bamboo\Core\RouteDefinition</code> instance for explicit signatures.</li> </ul> <p><code>RouteDefinition::signature</code> overrides the derived signature used for cache keys and request context metadata. When omitted, the router uses <code>"&lt;METHOD&gt; &lt;PATH&gt;"</code>.</p> <h3 id=parameter-tokens>Parameter tokens<a class=headerlink href=#parameter-tokens title="Permanent link">&para;</a></h3> <p>Paths follow FastRoute syntax. <code>{name}</code> captures a single path segment using the <code>[^/]+</code> regex. Inline constraints are supported: <code>{id:\d+}</code> restricts the token to digits, <code>{slug:[a-z0-9\-]+}</code> enforces slug-friendly characters. Matched variables are passed to the handler as part of the <code>$vars</code> array or injected via argument names (<code>$id</code>, <code>$slug</code>) when the callable signature includes them.</p> <p>Closures and controller methods may type-hint the PSR-7 request or the application container; the router performs best-effort argument matching. The following invocation strategies are part of the contract:</p> <div class=highlight><pre><span></span><code><span class=x>$router-&gt;get(&#39;/demo/{id}&#39;, function (ServerRequestInterface $request, array $vars, Application $app) {</span>
<span class=x>    // $request === the incoming request</span>
<span class=x>    // $vars === [&#39;id&#39; =&gt; &#39;123&#39;]</span>
<span class=x>    // $app   === Bamboo\Core\Application instance</span>
<span class=x>});</span>
</code></pre></div> <h2 id=middleware-composition>Middleware composition<a class=headerlink href=#middleware-composition title="Permanent link">&para;</a></h2> <p>Middleware ordering is deterministic:</p> <ol> <li><strong>Global middleware</strong> – <code>etc/middleware.php['global']</code>.</li> <li><strong>Group middleware</strong> – merged for each named group listed by the route.</li> <li><strong>Route middleware</strong> – entries supplied directly to the route definition.</li> </ol> <p>Aliases declared under <code>etc/middleware.php['aliases']</code> are resolved before the pipeline executes. Modules may contribute additional entries via <code>ModuleInterface::middleware</code>; contributions are merged with the same ordering rules. See <code>tests/Core/ApplicationPipelineTest.php</code> for a thorough ordering specification and terminable middleware guarantees.</p> <h2 id=error-handling>Error handling<a class=headerlink href=#error-handling title="Permanent link">&para;</a></h2> <p>The router produces canonical JSON payloads for framework-level errors:</p> <ul> <li><strong>404 Not Found</strong> – <code>{"error":"Not Found"}</code></li> <li><strong>405 Method Not Allowed</strong> – <code>{"error":"Method Not Allowed"}</code> with an <code>Allow</code> header listing permitted verbs.</li> <li><strong>500 Routing failure</strong> – <code>{"error":"Routing failure"}</code> emitted when an unexpected dispatcher status occurs.</li> </ul> <p>These responses inherit headers required for Prometheus and tracing middleware, ensuring monitoring remains consistent even when no route matches. Application middleware can override or extend the behaviour by catching responses upstream.</p> <h2 id=route-caching-contract>Route caching contract<a class=headerlink href=#route-caching-contract title="Permanent link">&para;</a></h2> <p><code>Router::cacheTo($file)</code> exports the in-memory map to PHP, enabling instant boot without re-registering routes. Because PHP cannot serialise closures safely, the cache routine rejects any definition that contains a closure and throws a <code>RuntimeException</code>. Operators should run <code>php bin/bamboo routes.cache</code> as part of build pipelines once the application route table stabilises.</p> <h2 id=deprecation-policy>Deprecation policy<a class=headerlink href=#deprecation-policy title="Permanent link">&para;</a></h2> <ul> <li>Existing helper methods (<code>get</code>, <code>post</code>, <code>addRoute</code>, <code>gatherMiddleware</code>) remain stable throughout the 1.x line. New helpers may be added in minor releases.</li> <li>Future helper deprecations must trigger <code>E_USER_DEPRECATED</code> notices while keeping the old API functional for at least one minor release.</li> <li>Parameter token semantics and the default error payload schema are frozen; any changes require a new major release with upgrade-guide choreography.</li> </ul> <h2 id=contract-validation>Contract validation<a class=headerlink href=#contract-validation title="Permanent link">&para;</a></h2> <ul> <li><code>tests/Http/ApplicationRoutesTest.php</code> exercises built-in routes, parameter injection, and the Prometheus <code>/metrics</code> exporter.</li> <li><code>tests/Core/ApplicationPipelineTest.php</code> covers middleware ordering, alias resolution, and terminable middleware behaviour.</li> <li><code>tests/Roadmap/V0_4/TimeoutMiddlewareTest.php</code> and <code>tests/Roadmap/V0_4/CircuitBreakerMiddlewareTest.php</code> ensure resilience middleware integrates correctly with router-driven signatures.</li> <li><code>tests/Console/RoutesShowCommandTest.php</code> and <code>tests/Core/ApplicationModulesTest.php</code> guard the cached route format and module contributions.</li> </ul> <p>Together with the new <code>config.validate</code> command, these suites guarantee the router contract is exercised in CI before the v1.0 release is tagged.</p> <h1 id=http-router-contract-v10-freeze_1>HTTP Router Contract (v1.0 Freeze)<a class=headerlink href=#http-router-contract-v10-freeze_1 title="Permanent link">&para;</a></h1> <p>Bamboo's HTTP router exposes the framework's primary public surface area. This reference freezes the v1.x contract so that applications can rely on routing, middleware, and error semantics remaining stable across the major series.</p> <h2 id=supported-http-methods-and-helpers>Supported HTTP methods and helpers<a class=headerlink href=#supported-http-methods-and-helpers title="Permanent link">&para;</a></h2> <h3 id=registration-apis>Registration APIs<a class=headerlink href=#registration-apis title="Permanent link">&para;</a></h3> <p><code>Bamboo\Core\Router</code> normalises every route into an internal map keyed by the uppercased HTTP method and URI template.【F:src/Core/Router.php†L11-L148】 Routes can be registered through the following helpers:</p> <ul> <li><code>addRoute($method, $path, $action, array $middleware = [], array $middlewareGroups = [])</code> is the generic entry-point. It accepts any RFC 7231 token (e.g. <code>PUT</code>, <code>PATCH</code>, <code>DELETE</code>, <code>OPTIONS</code>) and should be used for verbs other than GET/POST.【F:src/Core/Router.php†L14-L31】</li> <li><code>get($path, $action, array $middleware = [], array $middlewareGroups = [])</code> and <code>post(...)</code> delegate to <code>addRoute()</code> with a fixed method string.【F:src/Core/Router.php†L19-L25】</li> <li><code>RouteDefinition::forHandler(...)</code> is an ergonomic factory when you need to bundle middleware, middleware groups, or a custom signature with the handler metadata.【F:src/Core/RouteDefinition.php†L4-L19】</li> </ul> <p>Handlers may be:</p> <ul> <li>A callable (closure, invokable object, or function name).</li> <li>A <code>[ControllerClass::class, 'method']</code> pair; the router will instantiate the controller, pass it the current <code>Application</code>, and invoke the method.【F:src/Core/Router.php†L101-L108】</li> <li>An associative array with a <code>handler</code> key plus optional <code>middleware</code>, <code>middleware_groups</code>/<code>middlewareGroups</code>/<code>groups</code>, and <code>signature</code> overrides; the router normalises these shapes so downstream code receives a consistent structure.【F:src/Core/Router.php†L120-L148】</li> </ul> <p>The dispatcher reflects handler arguments and automatically injects the PSR-7 request, the route variable array, and the running <code>Application</code> instance when a parameter's type-hint or name matches one of those services.【F:src/Core/Router.php†L167-L239】</p> <h3 id=middleware-attachments>Middleware attachments<a class=headerlink href=#middleware-attachments title="Permanent link">&para;</a></h3> <p>Each route may supply inline middleware aliases and middleware groups. At normalisation time the router flattens these lists, merges any values provided by <code>RouteDefinition</code> or associative array metadata, and stores them separately so they can be combined with the configured global and group stacks during request handling.【F:src/Core/Router.php†L120-L148】【F:src/Core/Application.php†L42-L57】</p> <h3 id=parameter-tokens-and-uri-patterns>Parameter tokens and URI patterns<a class=headerlink href=#parameter-tokens-and-uri-patterns title="Permanent link">&para;</a></h3> <p>Bamboo delegates path compilation and matching to FastRoute, so URI templates use FastRoute's token syntax. The router passes method/path pairs directly to <code>FastRoute\RouteCollector</code>, which means:</p> <ul> <li>Curly-brace placeholders capture single path segments (e.g. <code>/hello/{name}</code> binds a <code>name</code> variable).【F:routes/http.php†L25-L30】【F:src/Core/Router.php†L63-L114】</li> <li>Placeholders may specify a custom regular expression using the <code>{token:pattern}</code> form. Because Bamboo does not alter the definition before it reaches FastRoute, the framework inherits FastRoute's default of <code>[^/]+</code> for unspecified patterns.【F:src/Core/Router.php†L63-L83】</li> <li>Optional segments and nested groups follow FastRoute's square-bracket syntax. Since definitions are forwarded verbatim, any template supported by FastRoute's parser is accepted by Bamboo.【F:src/Core/Router.php†L63-L83】</li> </ul> <h3 id=canonical-route-examples>Canonical route examples<a class=headerlink href=#canonical-route-examples title="Permanent link">&para;</a></h3> <p>The default application registers routes using the helpers described above. These examples double as integration tests for the router contract:</p> <p><div class=highlight><pre><span></span><code><span class=x>$router-&gt;get(&#39;/metrics&#39;, RouteDefinition::forHandler([</span>
<span class=x>    Bamboo\Web\Controller\MetricsController::class, &#39;index&#39;],</span>
<span class=x>));</span>

<span class=x>$router-&gt;get(&#39;/hello/{name}&#39;, RouteDefinition::forHandler(</span>
<span class=x>    function ($request, $vars) {</span>
<span class=x>        return new Nyholm\Psr7\Response(200, [&#39;Content-Type&#39; =&gt; &#39;text/plain&#39;], &quot;Hello, {$vars[&#39;name&#39;]}!\n&quot;);</span>
<span class=x>    },</span>
<span class=x>    middleware: [Bamboo\Web\Middleware\SignatureHeader::class],</span>
<span class=x>));</span>

<span class=x>$router-&gt;post(&#39;/api/echo&#39;, function ($request) {</span>
<span class=x>    $body = (string) $request-&gt;getBody();</span>
<span class=x>    return new Nyholm\Psr7\Response(200, [&#39;Content-Type&#39; =&gt; &#39;application/json&#39;], $body ?: &#39;{}&#39;);</span>
<span class=x>}, [Bamboo\Web\Middleware\SignatureHeader::class]);</span>
</code></pre></div> 【F:routes/http.php†L8-L65】</p> <h2 id=error-handling-behaviour>Error handling behaviour<a class=headerlink href=#error-handling-behaviour title="Permanent link">&para;</a></h2> <h3 id=dispatcher-outcomes>Dispatcher outcomes<a class=headerlink href=#dispatcher-outcomes title="Permanent link">&para;</a></h3> <p><code>Router::match()</code> wraps FastRoute's dispatcher and returns a structured array containing the outcome, allowed methods (for 405 responses), and extracted route variables. This structure feeds directly into the HTTP response generator used by <code>Application::handle()</code>.【F:src/Core/Router.php†L63-L117】【F:src/Core/Application.php†L37-L83】</p> <h3 id=json-responses>JSON responses<a class=headerlink href=#json-responses title="Permanent link">&para;</a></h3> <p>The router standardises three error payloads when a request cannot be fulfilled by application code:</p> <table> <thead> <tr> <th>Status</th> <th>Body</th> <th>Notes</th> </tr> </thead> <tbody> <tr> <td>404</td> <td><code>{ "error": "Not Found" }</code></td> <td>Returned when no route matches the URI.【F:src/Core/Router.php†L95-L99】</td> </tr> <tr> <td>405</td> <td><code>{ "error": "Method Not Allowed" }</code></td> <td>Returned when the URI exists but does not accept the request method. The <code>match()</code> result still includes an <code>allowed</code> list for callers that need it.【F:src/Core/Router.php†L74-L115】</td> </tr> <tr> <td>500</td> <td><code>{ "error": "Routing failure" }</code></td> <td>Defensive fallback if FastRoute returns an unknown status code.【F:src/Core/Router.php†L95-L118】</td> </tr> </tbody> </table> <p>Each response is emitted with a <code>Content-Type: application/json</code> header. Because routing happens inside the middleware pipeline, global middleware such as the request ID generator still run and attach correlation headers even for 4xx/5xx responses.【F:src/Core/Application.php†L55-L83】【F:src/Web/Middleware/RequestId.php†L7-L22】</p> <h3 id=logging-and-correlation-expectations>Logging and correlation expectations<a class=headerlink href=#logging-and-correlation-expectations title="Permanent link">&para;</a></h3> <p>The request ID middleware stores the generated or propagated identifier, HTTP method, and route signature in <code>RequestContext</code>. That context is merged into every Monolog record so operators receive correlation IDs alongside error reports and 404/405 traces.【F:src/Web/Middleware/RequestId.php†L7-L22】【F:src/Core/Application.php†L31-L52】【F:src/Provider/AppProvider.php†L10-L27】 Regression tests assert both header propagation and structured logging metadata for matched and unmatched routes.【F:tests/Http/RequestIdMiddlewareTest.php†L31-L85】</p> <h3 id=regression-coverage>Regression coverage<a class=headerlink href=#regression-coverage title="Permanent link">&para;</a></h3> <ul> <li><code>ApplicationPipelineTest::testUnmatchedRoutesShareKernelCacheEntry</code> exercises repeated 404 responses and ensures the middleware stack executes with the expected context for missing routes.【F:tests/Core/ApplicationPipelineTest.php†L230-L263】</li> <li>The request ID middleware tests listed above confirm correlation IDs surface in responses and logs, covering the observable contract for error conditions.</li> </ul> <h2 id=middleware-ordering-guarantees>Middleware ordering guarantees<a class=headerlink href=#middleware-ordering-guarantees title="Permanent link">&para;</a></h2> <h3 id=pipeline-composition>Pipeline composition<a class=headerlink href=#pipeline-composition title="Permanent link">&para;</a></h3> <p>The application bootstraps a <code>Kernel</code> that expands middleware aliases and groups from configuration. For each request it concatenates the fully-expanded global stack with route-provided middleware (aliases and groups are recursively resolved). The resulting list is cached per-route signature so subsequent requests reuse the same ordering.【F:src/Core/Application.php†L42-L83】【F:src/Web/Kernel.php†L6-L123】</p> <p>Middleware are invoked in the order produced by the kernel, while "after" logic runs in the reverse order as the stack unwinds. Terminable middleware are queued and executed after a response is produced, preserving the same request instance that reached the termination hook.【F:src/Core/Application.php†L55-L83】</p> <h3 id=deterministic-ordering-guarantees>Deterministic ordering guarantees<a class=headerlink href=#deterministic-ordering-guarantees title="Permanent link">&para;</a></h3> <ul> <li>Global middleware always execute first, in declaration order, followed by expanded middleware groups, then route-scoped middleware aliases.【F:src/Web/Kernel.php†L21-L123】</li> <li>Group references and aliases are flattened depth-first. Circular references are detected and rejected to avoid infinite recursion.【F:src/Web/Kernel.php†L81-L107】</li> <li>The kernel invalidates its cache when the middleware configuration or the route cache file timestamp changes, ensuring stale stacks are never reused across deployments.【F:src/Web/Kernel.php†L36-L54】</li> </ul> <h3 id=regression-coverage_1>Regression coverage<a class=headerlink href=#regression-coverage_1 title="Permanent link">&para;</a></h3> <p><code>tests/Core/ApplicationPipelineTest.php</code> captures the execution order contract:</p> <ul> <li><code>testMiddlewarePipelineResolvesConfiguredOrder</code> asserts the global → group → route ordering, header mutations, and middleware cache reuse.【F:tests/Core/ApplicationPipelineTest.php†L180-L228】</li> <li><code>testKernelCacheInvalidatesWhenConfigurationChanges</code> and <code>testKernelCacheInvalidatesWhenRouteCacheTimestampChanges</code> ensure the kernel's cache invalidation semantics stay in sync with configuration updates and route cache refreshes.【F:tests/Core/ApplicationPipelineTest.php†L265-L319】</li> <li><code>testKernelCachesSingleEntryForUnmatchedRoutes</code> verifies unmatched requests share a <code>__global__</code> cache entry while still recording the active route in the request context.【F:tests/Core/ApplicationPipelineTest.php†L321-L361】</li> <li><code>testTerminableMiddlewareRunsAfterResponseIsProduced</code> exercises the termination hooks and guarantees the recorded events and response headers appear in the expected order.【F:tests/Core/ApplicationPipelineTest.php†L364-L404】</li> </ul> <h2 id=deprecation-policy_1>Deprecation policy<a class=headerlink href=#deprecation-policy_1 title="Permanent link">&para;</a></h2> <p>Router-facing helpers (<code>addRoute</code>, verb-specific helpers, <code>RouteDefinition</code> constructors, and middleware utilities) follow Bamboo's deprecation rules:</p> <ol> <li>Deprecations must trigger <code>E_USER_DEPRECATED</code> notices via <code>trigger_error()</code> as soon as an alternative exists. Notices include the planned removal version and migration guidance.</li> <li>Deprecated helpers remain available for at least one subsequent minor release (e.g. deprecated in v1.2, removed no earlier than v1.3) so applications have a full release cycle to migrate.</li> <li>Documentation and upgrade notes describe migration strategies, including suggested codemod patterns when a mechanical transformation exists (such as replacing <code>post()</code> with <code>addRoute('POST', ...)</code>).</li> </ol> <h2 id=contract-validation_1>Contract validation<a class=headerlink href=#contract-validation_1 title="Permanent link">&para;</a></h2> <p>The following regression suites cover the router contract:</p> <table> <thead> <tr> <th>Concern</th> <th>Test coverage</th> </tr> </thead> <tbody> <tr> <td>Route caching and closure safeguards</td> <td><code>tests/Core/RouterCacheTest.php</code>【F:tests/Core/RouterCacheTest.php†L20-L91】</td> </tr> <tr> <td>Middleware ordering, caching, and terminators</td> <td><code>tests/Core/ApplicationPipelineTest.php</code>【F:tests/Core/ApplicationPipelineTest.php†L180-L404】</td> </tr> <tr> <td>Request ID propagation and logging context</td> <td><code>tests/Http/RequestIdMiddlewareTest.php</code>【F:tests/Http/RequestIdMiddlewareTest.php†L31-L85】</td> </tr> <tr> <td>Default application routes</td> <td><code>routes/http.php</code> (serves as the canonical example suite)【F:routes/http.php†L8-L65】</td> </tr> </tbody> </table> <p>Future router-specific PHPUnit namespaces will live under <code>tests/Router/</code>; until then the existing suites above serve as the authoritative regression coverage for this contract.</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.expand", "navigation.indexes", "navigation.sections"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.f55a23d4.min.js></script> </body> </html>